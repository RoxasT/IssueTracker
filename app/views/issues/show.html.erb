<p id="notice"><%= notice %></p>

<div class="header">
  <div class="section-title">
    <h1><%= @issue.Title %></h1>
  </div>
  <div class="page-actions">
    <% if current_user %>
      <%= link_to new_issue_path, class: 'create-button' do %>
        <span class="add-icon">+</span>
        <span class="createi-button">Create issue</span>
      <% end %>
    <% end %>
  </div>
</div>

<div class="main-view">
  <div class="issue-header">
    <span class="issue-id">
      Issue #<%= @issue.id %>
    </span>
    <span class="issue-status">
      <%= @issue.Status %>
    </span>
    <div class="issue-toolbar">
      <% if current_user %>
          <a href="/issues/<%= @issue.id %>/attach" class="show-button">Attach</a>

          <a href="/issues/<%= @issue.id %>/edit" class="show-button">Edit</a>
            
          <%= link_to 'Delete', @issue,  method: :delete, class: 'show-button', data: { confirm: 'Are you sure you want to delete this issue?' } %>
      <% end %>
    </div>
  </div>
  
  <div class="issue-main-content">
    
    <div class="issue-info">

      <div class="issue-author">
        <a href="/issues?responsible=<%= @issue.user.name %>">
          
          <!-- AQUI ES POSARIA LA FOTO DE PERFIL --> 
          
          <span title="author-name"><%= @issue.user.name %></span>
        </a>
        created an issue
        <time class="created_at"><%= @issue.created_at.strftime('%Y-%m-%d')
        %></time>
      </div>

      <div class="issue-description">
        <% if @issue.Description %>
            <p class="description"><%= @issue.Description %></p>
        <% else %>
            <p class="no-description">No description provided.</p>
        <% end %>
      </div>
    
      <!-- BLOC ATTACHMENTS -->
      
      <div class="issue-comments-container">
        
      </div>
      
      <div class="sidebar">
        <div class="issue-attrs">
          <dl>
            <dt>Assigned to</dt>
            <dd>
              <a href="/issues?responsible=<%= @issue.assignee.name if !@issue.assignee.nil? %>">
                <span title="author-name"><%= @issue.assignee.name %></span>
              </a>
            </dd>
          </dl>
          
          <dl>
            <dt>Type</dt>
            <dd class="type with-icon">
              <%= @issue.Type %>
            </dd>
          </dl>
          
          <dl>
            <dt>Priority</dt>
            <dd class="priority with-icon">
              <%= @issue.Priority %>
            </dd>
          </dl>
          
          <dl>
            <dt>Status</dt>
            <dd class="status with-icon">
              <%= @issue.Status %>
            </dd>
          </dl>
          
          <dl>
            <dt>Votes</dt>
            <dd class="votes">
                <%= @issue.Votes %>
              </span>
            </dd>
          </dl>
          
      </div>
    </div>
  </div>
</div>
  
  
  
  
  
  
   
    
  
  
<p>
  <strong>Title:</strong>
  <%= @issue.Title %>
</p>

<p>
  <strong>Description:</strong>
  <%= @issue.Description %>
</p>

<p>
  <strong>Type:</strong>
  <%= @issue.Type %>
</p>

<p>
  <strong>Priority:</strong>
  <%= @issue.Priority %>
</p>

<p>
  <strong>Status:</strong>
  <%= @issue.Status %>
</p>

<p>
  <strong>Votes:</strong>
  <%= @issue.Votes %>
</p>

<p>
  <strong>Assignee:</strong>
  <%= @issue.assignee.name if !@issue.assignee.nil? %>
</p>

<p>
  <strong>Creator:</strong>
  <%= @issue.user.name %>
</p>

<p>
  <strong>Created:</strong>
  <%= time_ago_in_words(@issue.created_at) + " ago" %>
</p>

<p>
  <strong>Updated:</strong>
  <%= time_ago_in_words(@issue.updated_at) + " ago" %>
</p>

<%= link_to 'Edit', edit_issue_path(@issue) %> |
<%= link_to 'Back', issues_path %> |
<%= link_to 'Destroy', @issue, method: :delete, data: { confirm: 'Are you sure?' } %>

<h2>Comments</h2>
<% @issue.comments.each do |comment| %>
  <p>
    <strong>Commenter:</strong>
    <%= comment.commenter %>
  </p>
 
  <p>
    <strong>Comment:</strong>
    <%= comment.body %>
  </p>
<% end %>
 
<h2>Add a comment:</h2>
<%= form_with(model: [ @issue, @issue.comments.build ], local: true) do |form| %>
  <p>
    <%= form.label :commenter %><br>
    <%= form.text_field :commenter %>
  </p>
  <p>
    <%= form.label :body %><br>
    <%= form.text_area :body %>
  </p>
  <p>
    <%= form.submit %>
  </p>
<% end %>
 
<p>
  <% if @issue.Status == "Open" || @issue.Status == "New" %> 
    <%= link_to 'Resolve', update_status_url(id: @issue.id, status: "Resolved")%>
  <% else %>
    <%= link_to 'Open', update_status_url(id: @issue.id, status: "Open")%>
  <% end %>
</p>
<div class="dropdown">
    <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Workflow
    <span class="caret"></span></button>
    <ul class="dropdown-menu">
      <% Issue.status.each do |status| %>
        <% if status != @issue.Status %>
          <%= content_tag(:li, link_to(status, update_status_url(id: @issue.id, status: status))) %>
        <% end %>
      <% end %>
    </ul>
</div>