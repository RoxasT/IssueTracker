<!DOCTYPE html>

<div class="header">
  <div class="section-title">
    <h1>Issues</h1>
  </div>
  <div class="page-actions">
    <% if current_user %>
      <%= link_to new_issue_path, class: 'create-button' do %>
        <span class="add-icon">+</span>
        <span class="createi-button">Create issue</span>
      <% end %>
    <% end %>
  </div>
</div>


<div class="issues">

  <div class="issues-toolbar">
    <div class="filter-container">
      <p class="filter-label">Filters:</p>
      <ul class="filter-status">
        <li id="all" class="aui-button">
          <a href="/issues">All</a>
        </li>
        
        <li id="open" class="aui-button">
          <a href="/issues?status=open">Open</a>
        </li>
      
        <li id="mine" class="aui-button">
          <a href="/issues?responsible<%= current_user.name %>">Assigned</a>
        </li>
      
        <li id="watching" class="aui-button">
          <a href="/issues?watching=<%= current_user.name %>">Watching</a>
        </li>
      </ul>
    </div>
  </div>

  <h2>Issues (<%= @issues.to_a.size %>)</h2>

  <p id="issues-filter-criteria">
    <% if request.query_parameters[:kind] %>
      <b>type:</b> "<%= request.query_parameters[:kind] %>"
    <% end %>
    <% if request.query_parameters[:priority] %>
        <b>priority:</b> "<%= request.query_parameters[:priority] %>"
    <% end %>
    <% if request.query_parameters[:status] %>
        <b>status:</b> "<%= issue.Status[request.query_parameters[:status]] %>"
    <% end %>
    <% if request.query_parameters[:responsible] %>
        <b>assignee:</b> "<%= request.query_parameters[:responsible] %>"
    <% end %>
  </p>

  <table class="issue-list">
    <thead>
      <tr>
          <th scope="col">Title</th>
          <th scope="col">Type</th>
          <th scope="col">Priority</th>
          <th scope="col">Status</th>
          <th scope="col">Votes</th>
          <th scope="col">Assignee</th>
          <th scope="col">Creator</th>
          <th scope="col">Created</th>
          <th scope="col">Updated</th>
          <th colspan="3"></th>
        </tr>
    </thead>
    <tbody>
      <tbody>
        <% @issues.each do |issue| %>
          <tr>
            <td><%= link_to issue.Title , issue, class:"btn-link" %></td>
            <td><%= issue.Type %></td>
            <td><%= issue.Priority %></td>
            <td><%= issue.Status %></td>
            <td><%= issue.Votes %></td>
            <td><%= issue.assignee.name  if !issue.assignee.nil? %></td>
            <td><%= issue.user.name %></td>
            <td><%= time_ago_in_words(issue.created_at) + " ago" %></td>
            <td><%= time_ago_in_words(issue.updated_at) + " ago" %></td>
          </tr>
        <% end %>
      </tbody>
  </table>
</div>